<!DOCTYPE html><html lang="en" mode="light" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="AWS CLI - S3 sync 속도 개선하기" /><meta property="og:locale" content="en" /><meta name="description" content="AWS CLI의 sync 명령어를 통해서 S3의 데이터를 백업할 때, aws s3 sync s3://$bucket . 의 형태로 버킷단위로 sync를 진행하면 시간이 많이 걸렸습니다." /><meta property="og:description" content="AWS CLI의 sync 명령어를 통해서 S3의 데이터를 백업할 때, aws s3 sync s3://$bucket . 의 형태로 버킷단위로 sync를 진행하면 시간이 많이 걸렸습니다." /><link rel="canonical" href="https://junyeopp.github.io/posts/AWS_cli_S3_sync_speed_up/" /><meta property="og:url" content="https://junyeopp.github.io/posts/AWS_cli_S3_sync_speed_up/" /><meta property="og:site_name" content="Try Everything" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-18T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="AWS CLI - S3 sync 속도 개선하기" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-01-18T00:00:00+09:00","datePublished":"2022-01-18T00:00:00+09:00","description":"AWS CLI의 sync 명령어를 통해서 S3의 데이터를 백업할 때, aws s3 sync s3://$bucket . 의 형태로 버킷단위로 sync를 진행하면 시간이 많이 걸렸습니다.","headline":"AWS CLI - S3 sync 속도 개선하기","mainEntityOfPage":{"@type":"WebPage","@id":"https://junyeopp.github.io/posts/AWS_cli_S3_sync_speed_up/"},"url":"https://junyeopp.github.io/posts/AWS_cli_S3_sync_speed_up/"}</script><title>AWS CLI - S3 sync 속도 개선하기 | Try Everything</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Try Everything"><meta name="application-name" content="Try Everything"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> </a></div><div class="site-title mt-3"> <a href="/">Try Everything</a></div><div class="site-subtitle font-italic">시도하고 기록하기</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/junyeopp" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['junyeop.dev','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>AWS CLI - S3 sync 속도 개선하기</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>AWS CLI - S3 sync 속도 개선하기</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> junyeop </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Jan 18, 2022, 12:00 AM +0900" >Jan 18<i class="unloaded">2022-01-18T00:00:00+09:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="884 words">4 min read</span></div></div><div class="post-content"><p>AWS CLI의 <code class="language-plaintext highlighter-rouge">sync</code> 명령어를 통해서 S3의 데이터를 백업할 때, <code class="language-plaintext highlighter-rouge">aws s3 sync s3://$bucket .</code> 의 형태로 버킷단위로 <code class="language-plaintext highlighter-rouge">sync</code>를 진행하면 시간이 많이 걸렸습니다.</p><p><code class="language-plaintext highlighter-rouge">sync</code>를 할 때 파일 전송시간보다 어떤 파일을 옮겨야 할지 찾는데 시간이 더 많이 걸리는 것 같았고 네트워크 대역폭은 널널했었습니다. 이 대역폭을 가득 채우고 싶었습니다.</p><p>AWS에서 아래의 <a href="https://aws.amazon.com/premiumsupport/knowledge-center/s3-improve-transfer-sync-command/">두 가지 제안</a>을 찾을 수 있었습니다.</p><h1 id="1-prefix별로-aws-s3-sync-를-동시에-여러-개-실행하기">1. prefix별로 <code class="language-plaintext highlighter-rouge">aws s3 sync</code> 를 동시에 여러 개 실행하기</h1><p>기존에는 PowerShell script의 <code class="language-plaintext highlighter-rouge">foreach</code>를 통해 여러 개의 버킷을 순차적으로 sync하고 있었습니다.</p><p>병렬적으로 실행하기 위해서 PowerShell 7부터 지원하는 <code class="language-plaintext highlighter-rouge">ForEach-Object</code> 명령어의 <code class="language-plaintext highlighter-rouge">-Parallel</code> 옵션을 사용하기로 하였고, <a href="https://docs.microsoft.com/ko-kr/powershell/scripting/install/installing-powershell-on-windows?view=powershell-7.2#install-powershell-using-winget">Winget을 사용하여 PowersShell 7을 설치</a>하여 script를 작성해보았습니다.</p><p>(윈도우에 기본적으로 설치되어있던 PowerShell이 6.0부터 .NET Core를 기반으로 다양한 플랫폼을 지원하는 오픈 소스 프로젝트가 되었습니다. 그래서 PowerShell 7은 추가적으로 설치가 필요합니다.)</p><div class="language-powershell highlighter-rouge"><div class="code-header"> <span text-data=" Powershell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre><td class="rouge-code"><pre><span class="nv">$bucket</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"싱크 대상 버킷"</span><span class="w">
</span><span class="nv">$prefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"싱크 대상 폴더"</span><span class="w">
</span><span class="nv">$start_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Date</span><span class="w"> </span><span class="nt">-UFormat</span><span class="w"> </span><span class="s2">"%Y-%m-%d %T%Z"</span><span class="w">
</span><span class="nv">$start_date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Date</span><span class="w"> </span><span class="nt">-UFormat</span><span class="w"> </span><span class="s2">"%Y%m%d"</span><span class="w">

</span><span class="n">aws</span><span class="w"> </span><span class="nx">configure</span><span class="w"> </span><span class="nx">set</span><span class="w"> </span><span class="nx">s3.max_concurrent_requests</span><span class="w"> </span><span class="nx">30</span><span class="w">

</span><span class="p">[</span><span class="n">array</span><span class="p">]</span><span class="w"> </span><span class="nv">$parts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aws</span><span class="w"> </span><span class="nx">s3</span><span class="w"> </span><span class="nx">ls</span><span class="w"> </span><span class="nx">s3://</span><span class="nv">$bucket</span><span class="nx">/</span><span class="nv">$prefix</span><span class="nx">/</span><span class="w">

</span><span class="nv">$cur_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"현재 디렉토리 경로"</span><span class="w">
</span><span class="n">New-Item</span><span class="w"> </span><span class="nt">-Path</span><span class="w"> </span><span class="nv">$cur_path</span><span class="w"> </span><span class="nt">-Name</span><span class="w"> </span><span class="s2">"</span><span class="nv">${start_date}</span><span class="s2">_</span><span class="nv">${bucket}</span><span class="s2">_</span><span class="nv">${prefix}</span><span class="s2">"</span><span class="w"> </span><span class="nt">-ItemType</span><span class="w"> </span><span class="s2">"directory"</span><span class="w">
</span><span class="nv">$log_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"</span><span class="nv">$cur_path</span><span class="s2">\</span><span class="nv">${start_date}</span><span class="s2">_</span><span class="nv">${bucket}</span><span class="s2">_</span><span class="nv">${prefix}</span><span class="s2">"</span><span class="w">

</span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">"Syncing bucket '</span><span class="nv">$bucket</span><span class="s2">' (</span><span class="nv">$start_time</span><span class="s2">)..."</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-File</span><span class="w"> </span><span class="nt">-FilePath</span><span class="w"> </span><span class="s2">"</span><span class="nv">$log_path</span><span class="s2">\log.log"</span><span class="w"> </span><span class="nt">-Append</span><span class="w">
</span><span class="kr">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$p</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$parts</span><span class="p">)</span><span class="w">
</span><span class="p">{</span><span class="w">
    </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$p</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s2">"part"</span><span class="p">)</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nv">$part</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-split</span><span class="w"> </span><span class="nv">$p</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-Last</span><span class="w"> </span><span class="nx">1</span><span class="p">)</span><span class="o">.</span><span class="nf">Trim</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span><span class="w">
        </span><span class="p">[</span><span class="n">array</span><span class="p">]</span><span class="w"> </span><span class="nv">$nums</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aws</span><span class="w"> </span><span class="nx">s3</span><span class="w"> </span><span class="nx">ls</span><span class="w"> </span><span class="nx">s3://</span><span class="nv">$bucket</span><span class="nx">/</span><span class="nv">$prefix</span><span class="nx">/</span><span class="nv">$part</span><span class="nx">/</span><span class="w">

        </span><span class="kr">foreach</span><span class="w"> </span><span class="p">(</span><span class="nv">$n</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$nums</span><span class="p">)</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nv">$num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-split</span><span class="w"> </span><span class="nv">$n</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-Last</span><span class="w"> </span><span class="nx">1</span><span class="p">)</span><span class="o">.</span><span class="nf">Trim</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span><span class="w">
            </span><span class="kr">if</span><span class="w"> </span><span class="p">(((</span><span class="nv">$num</span><span class="w"> </span><span class="o">-split</span><span class="w"> </span><span class="s2">"="</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-Last</span><span class="w"> </span><span class="nx">1</span><span class="p">)</span><span class="w"> </span><span class="o">-gt</span><span class="w"> </span><span class="s2">"130"</span><span class="p">)</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">"    </span><span class="nv">$bucket</span><span class="s2">)/</span><span class="nv">$prefix</span><span class="s2">)/</span><span class="nv">$part</span><span class="s2">)/</span><span class="nv">$num</span><span class="s2">"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-File</span><span class="w"> </span><span class="nt">-FilePath</span><span class="w"> </span><span class="s2">"</span><span class="nv">$log_path</span><span class="s2">\log.log"</span><span class="w"> </span><span class="nt">-Append</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">

        </span><span class="nv">$nums</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ForEach-Object</span><span class="w"> </span><span class="nt">-Parallel</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nv">$n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$_</span><span class="w">
            </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="nv">$n</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s2">"num"</span><span class="p">)</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nv">$num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="o">-split</span><span class="w"> </span><span class="nv">$n</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-Last</span><span class="w"> </span><span class="nx">1</span><span class="p">)</span><span class="o">.</span><span class="nf">Trim</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span><span class="w">
                </span><span class="kr">if</span><span class="w"> </span><span class="p">(((</span><span class="nv">$num</span><span class="w"> </span><span class="o">-split</span><span class="w"> </span><span class="s2">"="</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Select-Object</span><span class="w"> </span><span class="nt">-Last</span><span class="w"> </span><span class="nx">1</span><span class="p">)</span><span class="w"> </span><span class="o">-gt</span><span class="w"> </span><span class="s2">"130"</span><span class="p">)</span><span class="w">
                </span><span class="p">{</span><span class="w">
                    </span><span class="n">aws</span><span class="w"> </span><span class="nx">s3</span><span class="w"> </span><span class="nx">sync</span><span class="w"> </span><span class="s2">"s3://</span><span class="si">$(</span><span class="nv">$</span><span class="nn">using</span><span class="p">:</span><span class="nv">bucket</span><span class="si">)</span><span class="s2">/</span><span class="si">$(</span><span class="nv">$</span><span class="nn">using</span><span class="p">:</span><span class="nv">prefix</span><span class="si">)</span><span class="s2">/</span><span class="si">$(</span><span class="nv">$</span><span class="nn">using</span><span class="p">:</span><span class="nv">part</span><span class="si">)</span><span class="s2">/</span><span class="nv">$num</span><span class="s2">"</span><span class="w"> </span><span class="s2">"로컬 디렉토리 경로\</span><span class="si">$(</span><span class="nv">$</span><span class="nn">using</span><span class="p">:</span><span class="nv">bucket</span><span class="si">)</span><span class="s2">\</span><span class="si">$(</span><span class="nv">$</span><span class="nn">using</span><span class="p">:</span><span class="nv">prefix</span><span class="si">)</span><span class="s2">\</span><span class="si">$(</span><span class="nv">$</span><span class="nn">using</span><span class="p">:</span><span class="nv">part</span><span class="si">)</span><span class="s2">\</span><span class="nv">$num</span><span class="s2">"</span><span class="w"> </span><span class="nx">2</span><span class="err">&gt;</span><span class="o">&amp;</span><span class="nx">1</span><span class="w"> </span><span class="err">&gt;</span><span class="w"> </span><span class="s2">"</span><span class="si">$(</span><span class="nv">$</span><span class="nn">using</span><span class="p">:</span><span class="nv">log_path</span><span class="si">)</span><span class="s2">\</span><span class="si">$(</span><span class="nv">$</span><span class="nn">using</span><span class="p">:</span><span class="nv">part</span><span class="si">)</span><span class="s2">_</span><span class="nv">$date</span><span class="s2">.log"</span><span class="w">
                </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w"> </span><span class="nt">-ThrottleLimit</span><span class="w"> </span><span class="mi">20</span><span class="w">

        </span><span class="nv">$mid_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Date</span><span class="w"> </span><span class="nt">-UFormat</span><span class="w"> </span><span class="s2">"%Y-%m-%d %T%Z"</span><span class="w">
        </span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">"current time: </span><span class="nv">$mid_time</span><span class="s2">, </span><span class="nv">$part</span><span class="s2">"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Out-File</span><span class="w"> </span><span class="nt">-FilePath</span><span class="w"> </span><span class="s2">"</span><span class="nv">$log_path</span><span class="s2">\log.log"</span><span class="w"> </span><span class="nt">-Append</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="nv">$end_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-Date</span><span class="w"> </span><span class="nt">-UFormat</span><span class="w"> </span><span class="s2">"%Y-%m-%d %T%Z"</span><span class="w">
</span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">"done (</span><span class="nv">$end_time</span><span class="s2">)"</span><span class="w">
</span><span class="n">Write-Output</span><span class="w"> </span><span class="s2">""</span><span class="w">
</span></pre></table></code></div></div><ul><li>S3 대상 버킷의 prefix의 구조는 <code class="language-plaintext highlighter-rouge">$bucket/$prefix/part=123/num=123/..</code>의 형태입니다.<ul><li><code class="language-plaintext highlighter-rouge">../num=123/..</code> 단위로 병렬적으로 <code class="language-plaintext highlighter-rouge">sync</code>를 하도록 구성하였습니다.</ul><li><code class="language-plaintext highlighter-rouge">aws s3 sync</code>의 출력값들을 시간정보와 함께 파일로 저장하기위해서 prefix별로 디렉토리를 만들고 그 안에 출력값들을 저장하도록 하였습니다.<li>num=130보다 큰 값들만 <code class="language-plaintext highlighter-rouge">sync</code>하도록 설정하였습니다.<li><code class="language-plaintext highlighter-rouge">ForEach-Object</code>에서 <code class="language-plaintext highlighter-rouge">-Parallel</code> 옵션을 통해 병렬처리를, <code class="language-plaintext highlighter-rouge">-ThrottleLimit</code>을 통해 동시에 실행될 수 있는 스크립트 수를 제한하였습니다.<li><code class="language-plaintext highlighter-rouge">ForEach-Object</code> 안으로 밖의 변수를 전달하기 위해 <code class="language-plaintext highlighter-rouge">$using:</code>을 사용하였습니다. ($bucket의 형태로는 ForEach-Object 밖의 변수를 사용할 수 없습니다.)</ul><h1 id="2-aws-cli의-max_concurrent_requests값을-수정하기">2. AWS CLI의 max_concurrent_requests값을 수정하기</h1><p>max_concurrent_requests의 기본값은 10이며, S3에 한 번에 전송할 수 있는 요청수를 나타냅니다.</p><p>기본값에서 실행하였을 때 시스템에 부하가 없었기에 max_concurrent_requests를 30정도로 수정하였습니다.</p><p><code class="language-plaintext highlighter-rouge">aws configure set s3.max_concurrent_requests 30</code></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/aws/'>AWS</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/dev/" class="post-tag no-text-decoration" >dev</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=AWS CLI - S3 sync 속도 개선하기 - Try Everything&url=https://junyeopp.github.io/posts/AWS_cli_S3_sync_speed_up/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=AWS CLI - S3 sync 속도 개선하기 - Try Everything&u=https://junyeopp.github.io/posts/AWS_cli_S3_sync_speed_up/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=AWS CLI - S3 sync 속도 개선하기 - Try Everything&url=https://junyeopp.github.io/posts/AWS_cli_S3_sync_speed_up/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/hackerrank_sql/">HackerRank SQL 문제</a><li><a href="/posts/python_for_coding_test_Graph_algorithms/">이것이 취업을 위한 코딩 테스트다 with 파이썬 - 그래프 알고리즘</a><li><a href="/posts/python_for_coding_test_Shortest_path/">이것이 취업을 위한 코딩 테스트다 with 파이썬 - 최단 경로</a><li><a href="/posts/python_for_coding_test_Dynamic_programming/">이것이 취업을 위한 코딩 테스트다 with 파이썬 - 다이나믹 프로그래밍</a><li><a href="/posts/python_for_coding_test_DFS_BFS/">이것이 취업을 위한 코딩 테스트다 with 파이썬 - DFS, BFS</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/python/">Python</a> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/dev/">dev</a> <a class="post-tag" href="/tags/db/">DB</a> <a class="post-tag" href="/tags/sql/">SQL</a> <a class="post-tag" href="/tags/cloudwatch/">CloudWatch</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/git/">Git</a> <a class="post-tag" href="/tags/mongodb/">MongoDB</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/MongoDB_Replica_Set_reconfig_without_downtime/"><div class="card-body"> <span class="timeago small" >Jan 6<i class="unloaded">2022-01-06T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>downtime없이 MongoDB Replica Set 설정 변경하기</h3><div class="text-muted small"><p> 상황 현재 상황은 docker로 MongoDB가 실행되고 있으며, PSA 구조(Primary 1개, Secondary 1개, Arbiter 1개)의 Replica Set으로 구성되어 있는 상황입니다. 그리고 변경해야하는 사항들은 다음과 같습니다. Replica Set의 host 주소를 IP에서 URI로 변경하기 mongod.conf 파일의...</p></div></div></a></div><div class="card"> <a href="/posts/AWS_CodeCommit_migration/"><div class="card-body"> <span class="timeago small" >Jan 18<i class="unloaded">2022-01-18T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AWS CodeCommit으로 Git repo 옮기기</h3><div class="text-muted small"><p> 기존에 사용하던 Git repository를 AWS CodeCommit으로 옮기고 credential helper를 이용해서 remote에 연결하는 과정을 정리하였습니다. 1. Git repository를 AWS CodeCommit으로 옮기기 : AWS Documentation을 따라가며 작성하였습니다. AWS User에게 적절한 권한을 준...</p></div></div></a></div><div class="card"> <a href="/posts/CloudWatch_agent/"><div class="card-body"> <span class="timeago small" >Jun 3, 2021<i class="unloaded">2021-06-03T00:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>CloudWatch agent</h3><div class="text-muted small"><p> EC2의 memory 사용량을 모니터링 하기 위해서 CloudWatch agent를 사용 docs: https://docs.aws.amazon.com/ko_kr/AmazonCloudWatch/latest/monitoring/Install-CloudWatch-Agent.html CloudWatchAgentServerPolicy권한을 가...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/AWS_CodeCommit_migration/" class="btn btn-outline-primary" prompt="Older"><p>AWS CodeCommit으로 Git repo 옮기기</p></a> <a href="/posts/python_for_coding_test_implement/" class="btn btn-outline-primary" prompt="Newer"><p>이것이 취업을 위한 코딩 테스트다 with 파이썬 - 구현</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/junyeopp">junyeop</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/python/">Python</a> <a class="post-tag" href="/tags/aws/">AWS</a> <a class="post-tag" href="/tags/dev/">dev</a> <a class="post-tag" href="/tags/db/">DB</a> <a class="post-tag" href="/tags/sql/">SQL</a> <a class="post-tag" href="/tags/cloudwatch/">CloudWatch</a> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/git/">Git</a> <a class="post-tag" href="/tags/mongodb/">MongoDB</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
